<MudDialog>
    <DialogContent>
        <MudText Typo="Typo.body2" Class="mb-4">
            Paste the signed response you received from someone who accepted your invitation.
            Both signatures will be verified to establish mutual trust.
        </MudText>

        <InviteVerificationPanel @ref="_panel"
                                 ShowCard="false"
                                 SuccessActions="@SuccessActionsFragment"
                                 FailureActions="@FailureActionsFragment" />
    </DialogContent>
    <DialogActions>
        @if (_panel?.IsVerificationComplete == true && _panel.IsVerificationSuccessful)
        {
            <MudButton OnClick="Reset">Verify Another</MudButton>
            <MudButton Color="Color.Primary"
                       Variant="Variant.Filled"
                       StartIcon="@Icons.Material.Filled.PersonAdd"
                       OnClick="Close">
                Add Contact
            </MudButton>
        }
        else if (_panel?.IsVerificationComplete == true)
        {
            <MudButton OnClick="Reset">Try Again</MudButton>
        }
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = default!;

    private InviteVerificationPanel? _panel;

    private RenderFragment SuccessActionsFragment => __builder =>
    {
        <MudText Typo="Typo.caption" Class="mud-text-secondary">
            Click "Add Contact" to save this verified contact to your trusted contacts list.
        </MudText>
    };

    private RenderFragment FailureActionsFragment => __builder =>
    {
        // No additional actions needed for failure - "Try Again" is in DialogActions
    };

    private void Close()
    {
        MudDialog.Close(DialogResult.Ok(true));
    }

    private void Reset()
    {
        _panel?.Reset();
        StateHasChanged();
    }
}
