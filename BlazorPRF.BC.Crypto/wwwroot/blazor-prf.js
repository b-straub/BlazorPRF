function f(t){t.fill(0)}function l(t){return btoa(String.fromCharCode(...t))}function w(t){let r=atob(t),n=new Uint8Array(r.length);for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);return n}function y(t){return l(new Uint8Array(t))}function g(t){return w(t).buffer}async function m(){return!(!window.PublicKeyCredential||typeof PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable=="function"&&!await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable())}async function b(){return typeof PublicKeyCredential>"u"||typeof PublicKeyCredential.isConditionalMediationAvailable!="function"?!1:await PublicKeyCredential.isConditionalMediationAvailable()}async function A(t,r){try{let n=crypto.getRandomValues(new Uint8Array(16)),e=t??r.rpName,i=r.authenticatorAttachment==="platform"?"platform":"cross-platform",o={challenge:crypto.getRandomValues(new Uint8Array(32)),rp:{name:r.rpName,id:r.rpId??window.location.hostname},user:{id:n,name:e,displayName:e},pubKeyCredParams:[{alg:-7,type:"public-key"},{alg:-257,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:i,residentKey:"required",userVerification:"discouraged"},timeout:r.timeoutMs,attestation:"none",extensions:{prf:{}}},s=await navigator.credentials.create({publicKey:o});return s===null?{success:!1,cancelled:!0}:s.getClientExtensionResults().prf?.enabled?{success:!0,value:{id:s.id,rawId:y(s.rawId)}}:{success:!1,errorCode:"PrfNotSupported"}}catch(n){return n instanceof DOMException&&n.name==="NotAllowedError"?{success:!1,cancelled:!0}:{success:!1,errorCode:"RegistrationFailed"}}}async function P(t){let r=await crypto.subtle.digest("SHA-256",t);return new Uint8Array(r)}async function h(t,r,n){let e=null;try{let o=new TextEncoder().encode(r),s=await P(o),a=g(t),d=n.authenticatorAttachment==="platform"?["internal"]:["internal","usb","nfc","ble"],c={challenge:crypto.getRandomValues(new Uint8Array(32)),allowCredentials:[{id:a,type:"public-key",transports:d}],timeout:n.timeoutMs,userVerification:"required",extensions:{prf:{eval:{first:s.buffer}}}},u=await navigator.credentials.get({publicKey:c});if(u===null)return{success:!1,cancelled:!0};let p=u.getClientExtensionResults().prf?.results;return p?.first?(e=new Uint8Array(p.first),e.length!==32?{success:!1,errorCode:"KeyDerivationFailed"}:{success:!0,value:l(e)}):{success:!1,errorCode:"PrfNotSupported"}}catch(i){return i instanceof DOMException&&i.name==="NotAllowedError"?{success:!1,cancelled:!0}:{success:!1,errorCode:"KeyDerivationFailed"}}finally{e&&f(e)}}async function x(t,r){let n=null;try{let i=new TextEncoder().encode(t),o=await P(i),s={challenge:crypto.getRandomValues(new Uint8Array(32)),rpId:r.rpId??window.location.hostname,timeout:r.timeoutMs,userVerification:"required",extensions:{prf:{eval:{first:o.buffer}}}},a=await navigator.credentials.get({publicKey:s});if(a===null)return{success:!1,cancelled:!0};let c=a.getClientExtensionResults().prf?.results;if(!c?.first)return{success:!1,errorCode:"PrfNotSupported"};if(n=new Uint8Array(c.first),n.length!==32)return{success:!1,errorCode:"KeyDerivationFailed"};let u=l(n);return{success:!0,value:{credentialId:l(new Uint8Array(a.rawId)),prfOutput:u}}}catch(e){return e instanceof DOMException&&e.name==="NotAllowedError"?{success:!1,cancelled:!0}:{success:!1,errorCode:"KeyDerivationFailed"}}finally{n&&f(n)}}async function B(){return m()}async function R(){return b()}async function K(t,r){let n=JSON.parse(r),e=await A(t,n);return JSON.stringify(e)}async function U(t,r,n){let e=JSON.parse(n),i=await h(t,r,e);return!i.success||!i.value?JSON.stringify({success:!1,errorCode:i.errorCode,cancelled:i.cancelled}):JSON.stringify({success:!0,value:i.value})}async function N(t,r){let n=JSON.parse(r),e=await x(t,n);return!e.success||!e.value?JSON.stringify({success:!1,errorCode:e.errorCode,cancelled:e.cancelled}):JSON.stringify({success:!0,value:{credentialId:e.value.credentialId,prfOutput:e.value.prfOutput}})}var C={isPrfSupported:B,isConditionalMediationAvailable:R,register:K,evaluatePrfOutput:U,evaluatePrfDiscoverableOutput:N};globalThis.blazorPrf=C;var z=C;export{z as default,N as evaluatePrfDiscoverableOutput,U as evaluatePrfOutput,R as isConditionalMediationAvailable,B as isPrfSupported,K as register};
