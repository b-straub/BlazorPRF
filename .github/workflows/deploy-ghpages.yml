name: Deploy to GitHub Pages

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write
      id-token: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '10.0.x'

      - name: Install wasm-tools workload
        run: dotnet workload install wasm-tools

      - name: Create local NuGet folder
        run: mkdir -p .nuget

      - name: Set base path for GitHub Pages
        run: |
          sed -i 's|<base href="/" />|<base href="/BlazorPRF/" />|g' BlazorPRF.Sample/wwwroot/index.html

      - name: Publish Sample
        run: dotnet publish BlazorPRF.Sample/BlazorPRF.Sample.csproj -c Release -o ./build

      - name: Add .nojekyll and 404.html
        run: |
          cd build/wwwroot
          touch .nojekyll
          cp index.html 404.html

      - name: List _content folders
        run: |
          echo "=== _content folders ==="
          find build/wwwroot/_content -type d 2>/dev/null || echo "No _content folder"
          echo ""
          echo "=== JS files in _content ==="
          find build/wwwroot/_content -name "*.js" 2>/dev/null || echo "No JS files"

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./build/wwwroot

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
