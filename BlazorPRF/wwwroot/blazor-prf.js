function f(t){t.fill(0)}function l(t){return btoa(String.fromCharCode(...t))}function C(t){let r=atob(t),n=new Uint8Array(r.length);for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);return n}function y(t){return l(new Uint8Array(t))}function g(t){return C(t).buffer}async function m(){return!(!window.PublicKeyCredential||typeof PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable=="function"&&!await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable())}async function A(t,r){try{let n=crypto.getRandomValues(new Uint8Array(16)),e=t??r.rpName,s=r.authenticatorAttachment==="platform"?"platform":"cross-platform",o={challenge:crypto.getRandomValues(new Uint8Array(32)),rp:{name:r.rpName,id:r.rpId??window.location.hostname},user:{id:n,name:e,displayName:e},pubKeyCredParams:[{alg:-7,type:"public-key"},{alg:-257,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:s,residentKey:"required",userVerification:"discouraged"},timeout:r.timeoutMs,attestation:"none",extensions:{prf:{}}},i=await navigator.credentials.create({publicKey:o});return i===null?{success:!1,cancelled:!0}:i.getClientExtensionResults().prf?.enabled?{success:!0,value:{id:i.id,rawId:y(i.rawId)}}:{success:!1,errorCode:"PrfNotSupported"}}catch(n){return n instanceof DOMException&&n.name==="NotAllowedError"?{success:!1,cancelled:!0}:{success:!1,errorCode:"RegistrationFailed"}}}async function P(t){let r=await crypto.subtle.digest("SHA-256",t);return new Uint8Array(r)}async function b(t,r,n){let e=null;try{let o=new TextEncoder().encode(r),i=await P(o),a=g(t),p=n.authenticatorAttachment==="platform"?["internal"]:["internal","usb","nfc","ble"],u={challenge:crypto.getRandomValues(new Uint8Array(32)),allowCredentials:[{id:a,type:"public-key",transports:p}],timeout:n.timeoutMs,userVerification:"required",extensions:{prf:{eval:{first:i.buffer}}}},c=await navigator.credentials.get({publicKey:u});if(c===null)return{success:!1,cancelled:!0};let d=c.getClientExtensionResults().prf?.results;return d?.first?(e=new Uint8Array(d.first),e.length!==32?{success:!1,errorCode:"KeyDerivationFailed"}:{success:!0,value:l(e)}):{success:!1,errorCode:"PrfNotSupported"}}catch(s){return s instanceof DOMException&&s.name==="NotAllowedError"?{success:!1,cancelled:!0}:{success:!1,errorCode:"KeyDerivationFailed"}}finally{e&&f(e)}}async function h(t,r){let n=null;try{let s=new TextEncoder().encode(t),o=await P(s),i={challenge:crypto.getRandomValues(new Uint8Array(32)),rpId:r.rpId??window.location.hostname,timeout:r.timeoutMs,userVerification:"required",extensions:{prf:{eval:{first:o.buffer}}}},a=await navigator.credentials.get({publicKey:i});if(a===null)return{success:!1,cancelled:!0};let u=a.getClientExtensionResults().prf?.results;if(!u?.first)return{success:!1,errorCode:"PrfNotSupported"};if(n=new Uint8Array(u.first),n.length!==32)return{success:!1,errorCode:"KeyDerivationFailed"};let c=l(n);return{success:!0,value:{credentialId:l(new Uint8Array(a.rawId)),prfOutput:c}}}catch(e){return e instanceof DOMException&&e.name==="NotAllowedError"?{success:!1,cancelled:!0}:{success:!1,errorCode:"KeyDerivationFailed"}}finally{n&&f(n)}}async function O(){return m()}async function B(t,r){let n=JSON.parse(r),e=await A(t,n);return JSON.stringify(e)}async function R(t,r,n){let e=JSON.parse(n),s=await b(t,r,e);return!s.success||!s.value?JSON.stringify({success:!1,errorCode:s.errorCode,cancelled:s.cancelled}):JSON.stringify({success:!0,value:s.value})}async function U(t,r){let n=JSON.parse(r),e=await h(t,n);return!e.success||!e.value?JSON.stringify({success:!1,errorCode:e.errorCode,cancelled:e.cancelled}):JSON.stringify({success:!0,value:{credentialId:e.value.credentialId,prfOutput:e.value.prfOutput}})}var x={isPrfSupported:O,register:B,evaluatePrfOutput:R,evaluatePrfDiscoverableOutput:U};globalThis.blazorPrf=x;var J=x;export{J as default,U as evaluatePrfDiscoverableOutput,R as evaluatePrfOutput,O as isPrfSupported,B as register};
